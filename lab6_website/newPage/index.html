<!DOCTYPE HTML>
<!--
	Big Picture by HTML5 UP
	html5up.net | @n33co
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
	    <meta charset="utf-8">
	    <meta http-equiv="X-UA-Compatible" content="IE=edge">
	    <meta name="viewport" content="width=device-width, initial-scale=1">

		<title>Connor and Noah's 5760 Final Project</title>
		<meta http-equiv="content-type" content="text/html; charset=utf-8" />
		<meta name="description" content="" />
		<meta name="keywords" content="" />


	    <!-- Note: All core EaselJS classes are listed here: -->
	    <script type="text/javascript" src="./src/createjs/events/Event.js"></script>
	    <script type="text/javascript" src="./src/createjs/events/EventDispatcher.js"></script>
	    <script type="text/javascript" src="./src/createjs/utils/IndexOf.js"></script>
	    <script type="text/javascript" src="./src/easeljs/utils/UID.js"></script>
	    <script type="text/javascript" src="./src/easeljs/utils/Ticker.js"></script>
	    <script type="text/javascript" src="./src/easeljs/geom/Matrix2D.js"></script>
	    <script type="text/javascript" src="./src/easeljs/geom/Point.js"></script>
	    <script type="text/javascript" src="./src/easeljs/geom/Rectangle.js"></script>
	    <script type="text/javascript" src="./src/easeljs/display/Shadow.js"></script>
	    <script type="text/javascript" src="./src/easeljs/display/SpriteSheet.js"></script>
	    <script type="text/javascript" src="./src/easeljs/display/Graphics.js"></script>
	    <script type="text/javascript" src="./src/easeljs/display/DisplayObject.js"></script>
	    <script type="text/javascript" src="./src/easeljs/display/Container.js"></script>
	    <script type="text/javascript" src="./src/easeljs/display/Stage.js"></script>
	    <script type="text/javascript" src="./src/easeljs/display/Bitmap.js"></script>
	    <script type="text/javascript" src="./src/easeljs/display/Sprite.js"></script>
	    <script type="text/javascript" src="./src/easeljs/display/BitmapAnimation.js"></script>
	    <script type="text/javascript" src="./src/easeljs/display/BitmapText.js"></script>
	    <script type="text/javascript" src="./src/easeljs/display/Shape.js"></script>
	    <script type="text/javascript" src="./src/easeljs/display/Text.js"></script>
	    <script type="text/javascript" src="./src/easeljs/display/DOMElement.js"></script>
	    <script type="text/javascript" src="./src/easeljs/events/MouseEvent.js"></script>
	    <script type="text/javascript" src="./src/easeljs/filters/Filter.js"></script>
	    <script type="text/javascript" src="./src/easeljs/ui/ButtonHelper.js"></script>
	    <script type="text/javascript" src="./src/easeljs/ui/Touch.js"></script>
	    <script type="text/javascript" src="./src/easeljs/utils/SpriteSheetUtils.js"></script>
	    <script type="text/javascript" src="./src/easeljs/utils/SpriteSheetBuilder.js"></script>
	    <script type="text/javascript" src="./pad.js"></script>
    	<script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js">  </script>

		<!--[if lte IE 8]><script src="css/ie/html5shiv.js"></script><![endif]-->
		<script src="js/jquery.min.js"></script>
		<script src="js/jquery.poptrox.min.js"></script>
		<script src="js/jquery.scrolly.min.js"></script>
		<script src="js/jquery.scrollzer.min.js"></script>
		<script src="js/jquery.scrollgress.min.js"></script>
		<script src="js/skel.min.js"></script>
		<script src="js/skel-layers.min.js"></script>
		<script src="js/init.js"></script>
		<noscript>
			<link rel="stylesheet" href="css/skel.css" />
			<link rel="stylesheet" href="css/style.css" />
			<link rel="stylesheet" href="css/style-wide.css" />
			<link rel="stylesheet" href="css/style-normal.css" />
			<link href="demoStyles.css" rel="stylesheet" type="text/css" />
		</noscript>

	    <!-- Latest compiled and minified CSS -->
	    <link rel="stylesheet" href="http://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
	    <link rel="stylesheet" href="./css/style.css">
	    <!--[if lt IE 9]>
	      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
	      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
	    <![endif]-->
		<!--[if lte IE 8]><link rel="stylesheet" href="css/ie/v8.css" /><![endif]-->
	</head>

	<body onload="init();">

		<!-- Header -->
			<div id="header" class="skel-layers-fixed">

				<div class="top">

					<!-- Logo -->
						<div id="logo">
							<h1 id="logo">Final Project Demo</h1>
						</div>

						<!-- Nav -->
						<nav id="nav">
							<ul>
								<li><a href="#home"id="top-link" class="skel-layers-ignoreHref"><span class="icon fa-home">Home</span></a></li>
								<li><a href="#intro"id="contact-link" class="skel-layers-ignoreHref"><span class="icon fa-envelope">Introduction</span></a></li>
								<li><a href="#report" id="about-link" class="skel-layers-ignoreHref"><span class="icon fa-user">Design and Testing Report</span></a></li>
								<li><a href="#gallery"id="portfolio-link" class="skel-layers-ignoreHref"><span class="icon fa-th">Gallery</span></a></li>
								<li><a href="#team"id="contact-link" class="skel-layers-ignoreHref"><span class="icon fa-envelope">Team</span></a></li>
								<li><a href="#contact"id="contact-link" class="skel-layers-ignoreHref"><span class="icon fa-envelope">Contact</span></a></li>
							</ul>
						</nav>

				</div>
			</div>

		<!-- Main -->
		<div id="main">
		<!-- Home -->
			<section id="home" class="one dark cover">
				<div class="container 75%">
					<header>
						<h2>ECE 5760 Final Project: Bruce in a Club</h2>
						<h3><strong>by Connor Archard and Noah Levy</strong></h3>
					</header>
					
					<p></p>
					
				</div>
			</section>
		
		<!-- One -->
			<section id="intro" class="two">
				<div class="container 75%">
					<header>
						<h2>"Sound Bite"</h2>
					</header>
					<p>For our final project in ECE 5760, we made a music visualizer that interprets the rhythm and spectral content of a song played through the line-in on the Altera DE2-115 to create novel graphical and auditory output. </p>
					<header>
						<h2>Introduction</h2>
					</header>
					<p>Bruce in the club reads in audio to the DE2-115 through the Wolfson Audio Codec. The output of the ADC on the audio codec is passed through a filter bank in order to analyze the spectral content of the song that is being played. A graphics module takes this information to render frames that display the spectral content of the input song to the user and to animate four dancers on the screen. When music is detected, a module will take the output of the lowest frequency filter to interpret the beat of the song and will propogate this information along to the graphics modules to control the dancers' animations. By taking advantage of parallel computing capabilities of FPGAs, the graphics module was able to track up to 64 objects on the screen at a time while tracking each object's relative depth to facilitate visual occlusion in a manner similar to the common occlusion culling technique in computer vision. This system resulted in a music visualizer that did not rely on screen buffering and would instead calculate the pixel value for each location on the screen ''in real time.'' While this might be considered computationally wasteful, it took advantage of the inherant strengths of the DE2-115 platform to elegantly do away with visual artifacts, facilitate 3D visualization, and allow for the import of arbitrary bitmaps to be displayed on the monitor.</p>

					<h2>Check out our Demo Video!</h2>
					<iframe width="420" height="315" src="https://www.youtube.com/embed/vyld4mhxC7M" frameborder="0" allowfullscreen></iframe>				
				</div>
			</section>
		
		<!-- Two -->
			<section id="report" class="three">
				<div class="container 75%">
					<header>
						<h2>Design and Testing</h2>
					</header>

					<h3>RTL Design</h3>
					<h4>Graphics Modules</h4>
					 <p>
					<!-- Connor section -->
					We used the hardware VGA controller that we have <a class="" href="https://github.com/carchard/ECE5760_Epiphyte/tree/master/lab2_DDA/DE2-115_Basic_Computer/verilog/VGA_Controller" role="button">referenced in previous labs</a> in order to generate the analog signal that would control the VGA monitor attached to the FPGA. As seen in the block diagrams in the gallery section below, this module will output the current VGA X, Y coordinate pair that it is trying to draw and expects three 8-bit inputs that correspond to the R, G, and B values that should be shown at that pixel. While most graphics systems rely on a screen buffer that will store the RGB value of each pixel in memory and then use the X and Y position outputs of the controller module to address into the memory, we decided to take advantage of the parallel computing abilities of the FPGA to implement a graphics module that could provide occlusion culling to enable us to animate the dancers in a three-dimensional space.</p>
					<p>
					Modules were created to draw the basic components, and then these modules were instantiated in higher-level constructions that would allow us to create complicated layered designs at an arbitrary X and Y position. These modules included blocks with parameterized colors, and the various body parts of the dancers: the head, torso, legs, and left and right arms. Reference the "Person Block Diagram" image in the gallery section below to see the inputs and outputs of some of these modules. In the basic modules, the current VGA X and Y position of the VGA controller would be read in and if statements would be used to determine if the pixel in question was within the region being controlled by the basic module. If the pixel was relevant, the output valid signal would be set high. If the basic module was a body part, the difference between the top left X and Y position of the component and the current VGA X and Y position would be used to address into a ROM that was initialized with a memory initialization file (.mif). These initialization files were created from bitmaps with 24-bit color depth (8R8G8B). The color value at the given address in ROM (or in the case of the solid color blocks, the color of the block) would be returned in a 24-bit wide signal. Due to the low resolution of the VGA display that we were using, we were able to store all of the bitmaps on the M9K blocks that were on-chip.</p>
					<p>
					Wrapper modules were then created to encapsulate these basic components and provide a first layer of arbitration between the various components to implement the occlusion culling mechanics. For example, in the <a class="" href="https://github.com/carchard/ECE5760_Epiphyte/blob/master/lab6_mvis/graphicsModules/drawBruce.v" role="button">drawBruce.v</a> file, a Bruce-head block, a Bruce-torso block, a Bruce-l-arm block, a Bruce-r-arm block, and a Bruce-legs block were instantiated and given initial X and Y positions based on the inputs to the drawBruce module. An arbiter would take in the output valid signals from each of the five basic blocks along with their output colors and would select the color data from the frontmost element. This nesting allowed us to implement a large number of complicated drawings in hardware without the need for a screen buffer and without having to worry about the potential of visual artifacts from frame to frame as a result of improper memory management. These wrapper modules would take in an initial top left X and Y position in addition to an animaiton top left X and Y, which allowed us to move some of the simple components within the wrapper module based on the rhythm of the song that was being played into the FPGA.</p>
					<p>
					At the top level of our graphics modules was the screen manager. This module housed instances of all of the wrapper modules that were composed of the basic components and performed a final level of arbitration between the various wrappers. This module could support up to 64 layers before the one-hot encoding fanned out and became too cumbersome to repeatedly fit in the FPGA. Given the ability to nest layers in the wrapper modules, however, our graphics hardware was able to render an arbitrary number of layers. Reference the graphics block diagram image in the gallery below to see how all of these modules fit together to render the screen pixel-by-pixel on each frame. This top module also contained a low-pass filter that would take in the audio data from the audio ADC and adjust the animation X and Y position that would be passed into the wrapper modules where local logic would inform the basic component modules of their new top left X and Y positions.</p>
					<p>
					This architecture took advantage of the strengths of the FPGA: utilization of the hundreds of thousands of logic elements to make high-speed custom logic, and hierarchical modularization. At the same time, we navigated the shortcomings of the development board that we were working with by avoiding the need to use SRAM or other memory sources to store an entire full-color VGA frame. The end result of this hardware was an easy to debug and a trivially expandable graphics package that could be informed by the audio inputs in order to create a unique music listening experience.</p>


					<!-- Noah section -->
					</p>
					<h4>Audio Modules</h4>
					 <p></p>
					<!-- Connor section -->

					<!-- Noah section -->
					<p>
				    A filter bank is not the only way to display the snapshot of the magnitude spectral content of a signal. A DFT (Discrete Fourier Transform), DHT (Discrete Hartley Transform) or DCT (Discrete Cosine Transform) could also be used to output the magnitude of the sampled spectra. However, for our application there were compelling reasons to go with a filter bank instead: in general, the DFT,DHT,and DCT can be implemented in O(nlogn), but these implementations tend to be fairly complicated; and they're outputs are inherently linearly spaced. As a result, FFT-type IP cores are usually used as black boxes on FPGAs. Since using a black box would not sufficiently contribute to our understanding of anything, and since we wanted our "frequency bins" to be logarithmically spaced, we decided to use a bank of IIR (infinite impulse response) band-pass filters of varying widths across the audible range. 
					</p>
					<p>
					From here we had the choice of a floating or fixed point filter implementation. On the 5760 website, there is already a good <a class="" href="https://people.ece.cornell.edu/land/courses/ece5760/FloatingPoint/index.html" role="button">example</a> of a IIR filter implemented using 18-bit floating point on the DE2. Floating point is useful for filters when signals vary over a wide dynamic range. In general, this helps prevent overflow issues from cascading to a filter's output, but floating point numbers themselves are rather messy to implement. Just like the DFT option, we chose not to use floating point for our application so that we could avoid having to base our filters on the work of others.</p>

					<p>
					Because we were not interested in phase information from the input signal, we did not have to consider the phase response of our system when designing our filter. As a result, our basic decision in selecting a filter type was between steepness of the transition band and flatness of the passband. In the end, we found that the steepness of our transition band mattered little in the final display, but a flat pass-band was useful so that the output audio from our system, which was the sum of the filter outputs, would not add random gain and attenuation to arbitrary frequencies. For this reason we decided to use a 2nd order (2 pairs of conjugate poles and 2 pairs of conjugate zeros) butterworth bandpass filter. We selected 7 logarithimically spaced frequency bins and used them as the input to the MATLAB filter design toolbox's "butter". 
					</p>


					<h4>Systems Integration</h4>
					 <p>
					<!-- Connor section -->

					<!-- Noah section -->
					</p>
					<h3>Testing</h3>
					 <p>
					<!-- Connor section -->

					<!-- Noah section -->
					</p>
					<h2>Results</h2>


					<h3>Demonstration</h3>
					<p>See embedded video in the Introduction Section!</p>


					<h2>Conclusions</h2>
					 <p>
					<!-- Connor section -->

					<!-- Noah section -->
					</p>

					<h3>Societal Impacts</h3>
					 <p>
					<!-- Connor section -->

					<!-- Noah section -->
					</p>

					<h3>Ethical Considerations</h3>
					 <p>
					<!-- Connor section -->

					<!-- Noah section -->
					</p>


					<h2>Appendices</h2>
					<h3>Budgeting</h3>
					<div id="wrapper">
						<table border="2" style="width:80%">
						<tbead>
		 					<tr>
		 						<td><b>Part:</b></td>
		 						<td><b>Description:</b></td>
		 						<td><b>Cost:</b></td>
		 					</tr>
		 				</thead>
		 				<tbody>
	 					<tr>
	 						<td>DE2-115</td>
	 						<td>Altera development board used as the platform for this project</td>
	 						<td>$0</td>
	 					</tr>
	 					<tr>
	 						<td>VGA Monitor</td>
	 						<td>Display used to output the music visualization</td>
	 						<td>$0</td>
	 					</tr>
	 					<tr>
	 						<td>VGA and Aux Cables</td>
	 						<td>Connected the FPGA to a display and to a music source</td>
	 						<td>$0</td>
	 					</tr>
	 					</tbody>
		 			</table>
		 			<p></p>
		 			<p></p>
		 			<p></p>
		 			<h3>Software Listing</h3>
					<p><strong>Top File</strong> - The main Verilog file that connected all of the modules on the Cyclone IV together . View <a class="" href="https://github.com/carchard/ECE5760_Epiphyte" role="button" type="button" class="button style2 down">here</a>.</p>

					<p><strong>To see a full listing of our final code, view it on github: <a class="" href="https://github.com/carchard/ECE5760_Epiphyte" role="button" type="button" class="button style2 down">here</a></p>

					<h3>References</h3>
					<p><a class="" href="https://github.com/martinmarinov/TempestSDR/blob/master/documentation/acs-dissertation.pdf" role="button">Martin Marinov M.Eng Dissertation: "Remote Video Eavesdropping Using a Software-Defined Radio Platform"</a></p>
					<p><a class="" href="http://martin.hinner.info/vga/" role="button">VGA Standards Information</a></p>
					<p><a class="" href="https://github.com/Nuand/bladeRF" role="button">BladeRF Repository and Wiki</a></p>
					<p><a class="" href="http://www.cypress.com/file/139246/download" role="button">Cypress FX3 Datasheet</a></p>
					<p><a class="" href="https://www.element14.com/community/servlet/JiveServlet/previewBody/54502-102-1-273428/Cypress.User_Guide_3.pdf" role="button">Cypress GPIF II Development Guide</a></p>
					<p><a class="" href="http://www.cypress.com/file/139296/download" role="button">Cypress FX3 Quickstart Guide</a></p>
					<p><a class="" href="http://www.cypress.com/documentation/application-notes/an75779-how-implement-image-sensor-interface-using-ez-usb-fx3-usb" role="button">Cypress FX3 UVC Application Notes</a></p>
					<p><a class="" href="http://www.cypress.com/documentation/application-notes/an65974-designing-ez-usb-fx3-slave-fifo-interface" role="button">Cypress FX3 to FPGA Application Notes</a></p>
					
					
					</div>
				</div>
			</section>

		<!-- Work -->
			<section id="gallery" class="style3 primary">
				<div class="container 75%">
					<header>
						<h2>Gallery</h2>
						<p>Snapshots of our work/progress.</p>
					</header>
					
					<!-- Lightbox Gallery  -->
						<div class="container 75% gallery">
							<div class="row 0% images">
								<div class="6u"><a href="./images/dancers.jpg" class="image fit from-left"><img src="./images/dancers.jpg" title="Visualizer Screen Grab" alt="" /></a></div>
								<div class="6u"><a href="./images/top_BD.png" class="image fit from-right"><img src="./images/top_BD.png" title="Top-level Block Diagram" alt="" /></a></div>
							</div>
							<div class="row 0% images">
								<div class="6u"><a href="./images/audio_BD.png" class="image fit from-left"><img src="./images/audio_BD.png" title="Audio Block Diagram" alt="" /></a></div>
								<div class="6u"><a href="./images/graphics_BD.png" class="image fit from-right"><img src="./images/graphics_BD.png" title="Graphics Block Diagram" alt="" /></a></div>
							</div>
							<div class="row 0% images">
								<div class="6u"><a href="./images/person_BD.png" class="image fit from-left"><img src="./images/person_BD.png" title="Person Block Diagram" alt="" /></a></div>
								<div class="6u"><a href="./images/drawn_circuit.JPG" class="image fit from-right"><img src="./images/drawn_circuit.JPG" title="Test Circuit" alt="" /></a></div>
							</div>
						</div>

				</div>
			</section>
			


		<!-- Contact -->
			<section id="team" class="three">
				<div class="container 75%">
					<header>
						<h2>Team</h2>
					</header>
					<div class="row">
						<div class="col-lg-6">
						  <img class="img-circle img-responsive center-block" alt="100x100" src="./images/Connor.jpg" />
						  <h3 class="text-center">Connor Archard</h3>
						  <p class="text-center">Cornell ECE BS '15, Cornell Sysen ME '16</p>
						  <p class="text-center">
						    <a class="" href="https://www.linkedin.com/pub/connor-archard/87/8a0/aa8" role="button">Personal Website</a>
						  </p>
						</div>

						<div class="col-lg-6">
						  <img class="img-circle img-responsive center-block" alt="100x100" src="./images/Noah.jpg" />
						  <h3 class="text-center">Noah Levy</h3>
						  <p class="text-center">Cornell ECE BS '16, Cornell ECE ME '17.</p>
						  <p class="text-center">
						    <a class="" href="https://www.linkedin.com/in/noah-levy-518b4686" role="button">Personal Website</a>
						  </p>
						</div>
					</div>
				</div>    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->

			</section>
		<!-- Contact -->
			<section id="contact" class="three">
				<div class="container 75%">
					<header>
						<h2>Say Hello.</h2>
						<p>Or email us at <address><a href="mailto:cwa37@cornell.edu">cwa37@cornell.edu</a></address> and <address><a href="mailto:nml45@cornell.edu">nml45@cornell.edu</a></address>All work shown on this website belongs to us and may not be copied without our notification and prior agreement.</p>
					</header>
					</div>
				</div>
			</section>
		</div>

	</body>
</html>